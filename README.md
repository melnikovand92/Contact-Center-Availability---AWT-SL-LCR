# Доступность контакт-центра: **AWT / SL / LCR** (Power BI + SQL)

<p align="center">
  <a href="pbix/CallCenter_Availability.pbix?raw=1"><b>⬇️ Скачать отчёт (.pbix)</b></a><br/>
  Power BI Desktop: <b>2.148.878.0 (Октябрь 2025)</b>
</p>

---

## Оглавление
- [О проекте](#о-проекте)
- [Источники данных](#источники-данных)
- [Модель данных](#модель-данных)
- [KPI и методика расчётов](#kpi-и-методика-расчётов)
- [Визуализации](#визуализации)
- [Как воспроизвести](#как-воспроизвести)
- [QA-проверки](#qa-проверки)

---

## О проекте
Ежедневный мониторинг доступности линии контакт-центра по трём показателям:
- **AWT (Average Waiting Time)** — среднее ожидание до ответа, **цель ≤ 60 сек**.
- **SL (Service Level)** — доля ответов ≤ 60 сек среди всех *отвеченных*, **цель ≥ 80%**.
- **LCR (Lost Call Rate)** — доля потерянных среди *распределённых* на оператора, **цель ≤ 6%**.

Отчёт включает KPI-карточки со «светофором», тренды по дням, почасовую нормированную гистограмму SL и тепловую карту «день×час».

---

## Источники данных
Два CSV-файла (папка `/data`):
- `Enter_Answer.csv` — колонки:  
  `time_utc4 (datetime), phone_id (text), enter (int), answer (int), connid (text)`
- `AWT_AHT.csv` — колонки:  
  `time_utc3 (datetime), phone_id (text), aht (number), awt (number), connid (text)`

Пояснения:
- `enter` — звонок распределён (1/0)  
- `answer` — звонок отвечен (1/0)  
- `awt` — ожидание от распределения до ответа (сек)  
- `aht` — длительность разговора (сек)  
- `connid` — уникальный идентификатор контакта

---

## Модель данных
Связи (Single, активные):
- `Calendar[Date] (1) → Enter_Answer[date] (*)`
- `stg_AWT[connid] (1) → Enter_Answer[connid] (*)`

Подготовка:
- **Calendar** создаётся из min/max дат обеих таблиц и помечается как «таблица дат».
- **stg_AWT** — дубликат `AWT_AHT` с двумя полями `connid, awt` и удалёнными дублями по `connid`.  
  Используется для простого `RELATED(stg_AWT[awt])` в мерах.

> Полные DAX-меры: см. папку [`/dax`](dax).  
> SQL-проверки: см. папку [`/sql`](sql).

---

## KPI и методика расчётов
- **AWT (сек)** — среднее `awt` по *ответам* (где `enter=1 AND answer=1`) после соединения `Enter_Answer` с `stg_AWT` по `connid`.
- **SL (%)** = отвеченные за ≤60 сек / все отвеченные.  
  Числитель: `enter=1 AND answer=1 AND awt<=60`; знаменатель: `enter=1 AND answer=1`.
- **LCR (%)** = потерянные / распределённые.  
  Потерянные: `enter=1 AND answer=0`; распределённые: `enter=1`.

Цели и «светофор»:
- **AWT**: ≤60 — зелёный; 60–75 — жёлтый; >75 — красный.  
- **SL**: ≥80% — зелёный; 70–80% — жёлтый; <70% — красный.  
- **LCR**: ≤6% — зелёный; 6–10% — жёлтый; >10% — красный.  

В отчёте также показаны «дельты до цели»:
- `Δ AWT (сек) = AWT − 60`
- `Δ SL (п.п.) = (SL − 80%) * 100`
- `Δ LCR (п.п.) = (LCR − 6%) * 100`

---

## Визуализации
Скриншоты лежат в папке [`/images`](images):

1. **Общий дашборд** — KPI-карточки + сводные графики.  
   `images/01_dashboard_overview.png`
2. **KPI-карточки (цвет/дельты)** — AWT, SL, LCR.  
   `images/02_kpi_cards.png`
3. **Тренды по датам** — три линейных графика: AWT (сек), SL (%), LCR (%).  
   `images/03_trends.png`
4. **SL по часам** — нормированная гистограмма с бакетами «≤60»/«>60».  
   `images/04_sl_by_hour.png`
5. **Тепловая «день×час»** — матрица SL (%), подчёркивает провальные окна.  
   `images/05_heatmap.png`

---

## Как воспроизвести
1) **Импорт данных**
- *Главная → Получить данные → Текст/CSV* — загрузите `Enter_Answer.csv` и `AWT_AHT.csv`.
- Типы данных:  
  `enter/answer` — целое; `awt/aht` — десятичное; `connid` — текст; `time_utc3/time_utc4` — дата/время.

2) **Power Query**
- В `Enter_Answer` добавьте столбец `date = Date.From([time_utc4])`.
- В `AWT_AHT` добавьте `date = Date.From([time_utc3])`.
- Создайте запрос **stg_AWT** (дублируйте `AWT_AHT`), оставьте поля `connid, awt`, удалите дубли по `connid`.

3) **Модель**
- Создайте таблицу **Calendar** из min/max дат обеих таблиц и отметьте её как таблицу дат.
- Свяжите:
  - `Calendar[Date] (1) → Enter_Answer[date] (*)`
  - `stg_AWT[connid] (1) → Enter_Answer[connid] (*)`

4) **Меры**
- Импортируйте/вставьте меры из папки [`/dax`](dax) (KPI, дельты, цвета, почасовые).
- Карточкам подключите фон по мерам «цвета» (Формат → Визуальный элемент → Карточки → **Фон → fx**).

5) **Визуалы**
- KPI: три **карточки** (AWT, SL, LCR) + три **графика** (AWT/SL/LCR по датам).
- **Нормированная гистограмма**: X = `Hour`, Легенда = `SL бакет (≤60?)`, Значение = `Отвеченные звонки`.
- **Матрица**: Строки = `Calendar[Date]`, Столбцы = `Hour`, Значение = `SL %`.
- **Срез**: `Calendar[Date]` (стиль **Между**/Between).

---

## QA-проверки
- Срез даты влияет на все визуалы и KPI.
- `SL % = [SL (≤60, шт)] / [Отвеченные звонки]` — проверка совпадения.
- `LCR % = Потерянные / Распределённые` — проверка совпадения.
- В нормированной гистограмме сумма бакетов по каждому часу = **100%**.
- Карточки корректно меняют фон по «светофорам».
- В матрице «день×час» провалы SL совпадают с пиками AWT в те же окна.

---
